const btn=document.querySelector('.btn');const img=document.querySelector('#image');const topicEl=document.querySelector('#topic');const listEl=document.querySelector('#questions');const vocabEl=document.querySelector('#vocab');let QUESTIONS=null, VOCAB=null, busy=false;const Q_VER='v7', V_VER='v3';
Promise.all([fetch('questions.json?'+Q_VER).then(r=>r.json()), fetch('vocab.json?'+V_VER).then(r=>r.json())]).then(([q,v])=>{QUESTIONS=q.questions;VOCAB=v;}).catch(err=>{console.error('Load error:',err);topicEl.textContent='Error loading questions.';});
const pick=a=>a[Math.floor(Math.random()*a.length)]; const pickN=(a,n)=>{const p=[...a],o=[];while(p.length&&o.length<n){o.push(p.splice(Math.floor(Math.random()*p.length),1)[0])}return o};
function topicCategory(topic){const map=VOCAB.topic_to_cat||{};if(map[topic])return map[topic];const t=topic.toLowerCase();for(const [cat,list] of Object.entries(VOCAB.cats||{})){if(list.some(k=>t.includes(k.toLowerCase())))return cat;}return 'general';}
function buildVocab(topic){if(VOCAB.topic&&VOCAB.topic[topic]){return pickN(VOCAB.topic[topic], Math.min(8, VOCAB.topic[topic].length));}const cat=topicCategory(topic);const bank=(VOCAB.cat&&VOCAB.cat[cat])||(VOCAB.cat&&VOCAB.cat.general)||[];return pickN(bank, Math.min(8, bank.length));}
function generate(){if(busy||!QUESTIONS||!VOCAB)return;busy=true;topicEl.textContent='';listEl.innerHTML='';vocabEl.innerHTML='';if(img)img.src='img/loader.gif';setTimeout(()=>{const topics=Object.keys(QUESTIONS);const topic=pick(topics);const qs=(QUESTIONS[topic]||[]).slice(0,5);if(img)img.src='img/trans.png';topicEl.textContent=topic.toUpperCase();qs.forEach(q=>{const li=document.createElement('li');li.textContent=q;listEl.appendChild(li)});buildVocab(topic).forEach(w=>{const chip=document.createElement('span');chip.className='chip';chip.textContent=w;vocabEl.appendChild(chip)});busy=false;},280)}
btn.addEventListener('click', generate);document.addEventListener('keydown', e=>{if(e.key==='Enter')generate();});
